<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMYK Lithophane Designer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- External Library for ZIP creation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>

<!-- Progress Overlay -->
<div id="progressOverlay">
    <div class="progress-box">
        <h3 id="progressText">Processing...</h3>
        <div class="progress-bar-bg">
            <div id="progressBar" class="progress-bar-fill"></div>
        </div>
        <div id="progressSub">Initializing...</div>
    </div>
</div>

<div class="app-container">
    <!-- SIDEBAR -->
    <div class="sidebar">
        
        <!-- Section 1: Uploads -->
        <div class="control-section">
            <h3>1. Upload Assets</h3>
            <div class="upload-grid">
                <div class="upload-card">
                    <div class="upload-label">
                        <span class="upload-icon" style="background:#00d26a;"></span>
                        Photo (Color)
                    </div>
                    <input type="file" id="photoInput" accept="image/*">
                </div>
                
                <div class="upload-card">
                    <div class="upload-label">
                        <span class="upload-icon" style="background:#fff;"></span>
                        Mask (Optional)
                    </div>
                    <input type="file" id="maskInput" accept="image/*">
                </div>
            </div>
        </div>

        <!-- Section 2: Edit Controls -->
        <div class="control-section">
            <h3>2. Edit & Arrange</h3>
            <div class="layer-select">
                <div class="layer-btn active" id="btn-mask" onclick="selectLayer('mask')">Edit Mask</div>
                <div class="layer-btn" id="btn-photo" onclick="selectLayer('photo')">Edit Photo</div>
            </div>
            <div class="instructions">
                <strong>Controls:</strong><br>
                • <b>Drag Corners:</b> Resize Selection<br>
                • <b>Drag Top Handle:</b> Rotate Selection<br>
                • <b>Drag Middle:</b> Move Selection
            </div>
        </div>

        <!-- Section 3: Dimensions -->
        <div class="control-section">
            <h3>3. Final Dimensions (Export Size)</h3>
            <div class="dim-row">
                <div class="dim-group">
                    <span class="dim-label">Width</span>
                    <input type="number" id="inpWidth" class="dim-input" onchange="updateDims('w')">
                </div>
                <div class="dim-x">x</div>
                <div class="dim-group">
                    <span class="dim-label">Height</span>
                    <input type="number" id="inpHeight" class="dim-input" onchange="updateDims('h')">
                </div>
                <div>
                    <select id="unitSelect" class="unit-toggle" onchange="updateUnitDisplay()">
                        <option value="mm">mm</option>
                        <option value="in">in</option>
                    </select>
                </div>
            </div>
        </div>

        <button class="process-btn" onclick="generateLayers()">1. Generate Previews</button>
        <button id="btnDownload" class="process-btn" style="background:#333; color:#888; margin-top:10px;" onclick="download3MF()" disabled>2. Download 3MF</button>
    </div>

    <!-- MAIN CANVAS -->
    <div class="canvas-area">
        <canvas id="editorCanvas" width="800" height="600"></canvas>
    </div>

    <!-- OUTPUTS -->
    <div class="output-section">
        <h3 style="margin-top:0; color:#fff;">Generated Layers Preview</h3>
        <div class="preview-grid">
            <div class="channel-card"><h4>Composite Preview</h4><canvas id="refCanvas"></canvas></div>
            <div class="channel-card"><h4>Cyan (Thickness)</h4><canvas id="cCanvas"></canvas></div>
            <div class="channel-card"><h4>Magenta (Thickness)</h4><canvas id="mCanvas"></canvas></div>
            <div class="channel-card"><h4>Yellow (Thickness)</h4><canvas id="yCanvas"></canvas></div>
            <div class="channel-card"><h4>White (Base)</h4><canvas id="wCanvas"></canvas></div>
        </div>
    </div>
</div>

<script src="script.js"></script>
</body>
</html>